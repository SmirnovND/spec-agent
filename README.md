# spec-agent

CLI инструмент для управления спецификациями, управляемыми архитектурой (spec-driven architecture). Позволяет определять структуру кода через спецификации, автоматизировать их проверку и визуализировать зависимости.

## Основной концепт

Спецификации — это MD-файлы рядом с кодом, которые:
- Определяют архитектурные решения и контексты
- Описывают контракты и ограничения компонентов
- Управляют зависимостями между компонентами
- Документируют причины и ответственности

Инструмент помогает проверить консистентность спецификаций и понять граф их зависимостей.

## Установка

```bash
go install github.com/SmirnovND/spec-agent/cmd/spec-agent@latest
```

## Использование

### Инициализация проекта

```bash
spec-agent init
```

Создаёт структуру:
- `.spec_agent/config.yaml` — конфиг с корневыми путями для поиска спецификаций
- `spec_changes/` — директория для отслеживания изменений

### Проверка спецификаций

```bash
spec-agent lint
```

Проверяет все спецификации в директории `specs/` на наличие обязательных секций:
- `Контекст` — описание задачи/компонента
- `Ответственность` — что отвечает за что
- `Контракты` — API, интерфейсы
- `Ограничения` — constraints и assumptions

### Построение графа зависимостей

```bash
spec-agent graph
```

Анализирует спецификации и выводит ASCII-граф зависимостей. Определяет root-спеки (на которые никто не ссылается) и строит граф от них вниз.

### Проверка логических зависимостей

```bash
spec-agent check
```

**Статус**: MVP, требует реализации. Должна проверять:
- Циклические зависимости
- Нарушения контрактов
- Состояние синхронизации между спецификацией и кодом

## Структура проекта

```
spec-agent/
├── cmd/spec-agent/           # Точка входа приложения
│   └── main.go
├── internal/
│   ├── cli/                  # Команды CLI (Cobra)
│   │   ├── root.go
│   │   ├── init.go
│   │   ├── lint.go
│   │   ├── check.go
│   │   └── graph.go
│   ├── spec/                 # Логика работы со спецификациями
│   │   ├── model.go          # Структуры данных (Spec, Graph, Node, Edge)
│   │   ├── parser.go         # Парсинг MD-файлов спецификаций
│   │   ├── validator.go      # Валидация обязательных секций
│   │   ├── references.go     # Сбор ссылок между спецификациями
│   │   ├── roots.go          # Определение root-спек
│   │   └── graph_builder.go  # Построение графа зависимостей
│   ├── config/               # Загрузка конфигурации
│   │   └── config.go
│   ├── fs/                   # Работа с файловой системой
│   │   ├── init.go           # Инициализация проекта
│   │   └── scaffold.go       # Создание структуры каталогов
│   └── output/               # Вывод результатов
│       └── ascii.go          # ASCII-визуализация графа
├── go.mod
├── go.sum
└── README.md
```

## Зависимости

- **[Cobra](https://github.com/spf13/cobra)** — фреймворк для CLI команд
- **[gopkg.in/yaml.v3](https://pkg.go.dev/gopkg.in/yaml.v3)** — парсинг YAML конфига

## Формат спецификаций

Спецификации — это Markdown-файлы со следующей структурой:

```markdown
# Название компонента

## Контекст
Описание задачи, роли в системе, исторический контекст.

## Ответственность
Что этот компонент отвечает за реализацию.

## Контракты
Интерфейсы, структуры данных, API.

## Ограничения
Constraint'ы, assumptions, limitations.

## Зависимости
- Ссылка на другую спецификацию: [Component Name](../other/spec.md)
```

## Конфигурация

`.spec_agent/config.yaml`:

```yaml
roots:
  - internal/controllers  # Где искать спецификации
  - internal/middleware
```

## Примеры

Создание новой спецификации для компонента:

```markdown
# AuthController

## Контекст
REST API контроллер для аутентификации пользователей.

## Ответственность
- Валидация credentials
- Генерация JWT tokens
- Управление сессиями

## Контракты
- POST /login (email, password) → {token, expiresAt}
- POST /logout → {status}
- GET /profile → {user}

## Ограничения
- Password минимум 8 символов
- JWT expiration 24 часа
- Максимум 5 попыток входа за 5 минут
```

## Разработка

### Запуск тестов

```bash
go test ./...
```

### Сборка

```bash
go build -o spec-agent ./cmd/spec-agent
```
